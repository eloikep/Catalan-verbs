<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision Catalan</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div id="app"></div>
    <script>
// ==================== BASE DE DONN√âES ====================
const VERBS_DB = [
    {fr:'√™tre',es:'ser',ca:'ser',present:['soc','ets','√©s','som','sou','s√≥n'],subjunctive:['sigui','siguis','sigui','siguem','sigueu','siguin'],future:['ser√©','ser√†s','ser√†','serem','sereu','seran'],imperfect:['era','eres','era','√©rem','√©reu','eren'],gerund:'essent',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'avoir',es:'tener',ca:'tenir',present:['tinc','tens','t√©','tenim','teniu','tenen'],subjunctive:['tingui','tinguis','tingui','tinguem','tingueu','tinguin'],future:['tindr√©','tindr√†s','tindr√†','tindrem','tindreu','tindran'],imperfect:['tenia','tenies','tenia','ten√≠em','ten√≠eu','tenien'],gerund:'tenint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'aller',es:'ir',ca:'anar',present:['vaig','vas','va','anem','aneu','van'],subjunctive:['vagi','vagis','vagi','anem','aneu','vagin'],future:['anir√©','anir√†s','anir√†','anirem','anireu','aniran'],imperfect:['anava','anaves','anava','an√†vem','an√†veu','anaven'],gerund:'anant',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'faire',es:'hacer',ca:'fer',present:['faig','fas','fa','fem','feu','fan'],subjunctive:['faci','facis','faci','fem','feu','facin'],future:['far√©','far√†s','far√†','farem','fareu','faran'],imperfect:['feia','feies','feia','f√®iem','f√®ieu','feien'],gerund:'fent',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'pouvoir',es:'poder',ca:'poder',present:['puc','pots','pot','podem','podeu','poden'],subjunctive:['pugui','puguis','pugui','puguem','pugueu','puguin'],future:['podr√©','podr√†s','podr√†','podrem','podreu','podran'],imperfect:['podia','podies','podia','pod√≠em','pod√≠eu','podien'],gerund:'podent',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'vouloir',es:'querer',ca:'voler',present:['vull','vols','vol','volem','voleu','volen'],subjunctive:['vulgui','vulguis','vulgui','vulguem','vulgueu','vulguin'],future:['voldr√©','voldr√†s','voldr√†','voldrem','voldreu','voldran'],imperfect:['volia','volies','volia','vol√≠em','vol√≠eu','volien'],gerund:'volent',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'dire',es:'decir',ca:'dir',present:['dic','dius','diu','diem','dieu','diuen'],subjunctive:['digui','diguis','digui','diguem','digueu','diguin'],future:['dir√©','dir√†s','dir√†','direm','direu','diran'],imperfect:['deia','deies','deia','d√®iem','d√®ieu','deien'],gerund:'dient',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'venir',es:'venir',ca:'venir',present:['vinc','vens','ve','venim','veniu','venen'],subjunctive:['vingui','vinguis','vingui','vinguem','vingueu','vinguin'],future:['vindr√©','vindr√†s','vindr√†','vindrem','vindreu','vindran'],imperfect:['venia','venies','venia','ven√≠em','ven√≠eu','venien'],gerund:'venint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'savoir',es:'saber',ca:'saber',present:['s√©','saps','sap','sabem','sabeu','saben'],subjunctive:['s√†piga','s√†pigues','s√†piga','sapiguem','sapigueu','s√†piguen'],future:['sabr√©','sabr√†s','sabr√†','sabrem','sabreu','sabran'],imperfect:['sabia','sabies','sabia','sab√≠em','sab√≠eu','sabien'],gerund:'sabent',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'voir',es:'ver',ca:'veure',present:['veig','veus','veu','veiem','veieu','veuen'],subjunctive:['vegi','vegis','vegi','vegem','vegeu','vegin'],future:['veur√©','veur√†s','veur√†','veurem','veureu','veuran'],imperfect:['veia','veies','veia','v√®iem','v√®ieu','veien'],gerund:'veient',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'parler',es:'hablar',ca:'parlar',present:['parlo','parles','parla','parlem','parleu','parlen'],subjunctive:['parli','parlis','parli','parlem','parleu','parlin'],future:['parlar√©','parlar√†s','parlar√†','parlarem','parlareu','parlaran'],imperfect:['parlava','parlaves','parlava','parl√†vem','parl√†veu','parlaven'],gerund:'parlant',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'vivre',es:'vivir',ca:'viure',present:['visc','vius','viu','vivim','viviu','viuen'],subjunctive:['visqui','visquis','visqui','visquem','visqueu','visquin'],future:['viur√©','viur√†s','viur√†','viurem','viureu','viuran'],imperfect:['vivia','vivies','vivia','viv√≠em','viv√≠eu','vivien'],gerund:'vivint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'√©crire',es:'escribir',ca:'escriure',present:['escric','escrius','escriu','escrivim','escriviu','escriuen'],subjunctive:['escrigui','escriguis','escrigui','escriguem','escrigueu','escriguin'],future:['escriur√©','escriur√†s','escriur√†','escriurem','escriureu','escriuran'],imperfect:['escrivia','escrivies','escrivia','escriv√≠em','escriv√≠eu','escrivien'],gerund:'escrivint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'servir',es:'servir',ca:'servir',present:['serveixo','serveixes','serveix','servim','serviu','serveixen'],subjunctive:['serveixi','serveixis','serveixi','servim','serviu','serveixin'],future:['servir√©','servir√†s','servir√†','servirem','servireu','serviran'],imperfect:['servia','servies','servia','serv√≠em','serv√≠eu','servien'],gerund:'servint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'lire',es:'leer',ca:'llegir',present:['llegeixo','llegeixes','llegeix','llegim','llegiu','llegeixen'],subjunctive:['llegeixi','llegeixis','llegeixi','llegim','llegiu','llegeixin'],future:['llegir√©','llegir√†s','llegir√†','llegirem','llegireu','llegiran'],imperfect:['llegia','llegies','llegia','lleg√≠em','lleg√≠eu','llegien'],gerund:'llegint',periphrastic:['vaig','vas','va','vam','vau','van']},
    {fr:'manger',es:'comer',ca:'menjar',present:['menjo','menges','menja','mengem','mengeu','mengen'],subjunctive:['mengi','mengis','mengi','mengem','mengeu','mengin'],future:['menjar√©','menjar√†s','menjar√†','menjarem','menjareu','menjaran'],imperfect:['menjava','menjaves','menjava','menj√†vem','menj√†veu','menjaven'],gerund:'menjant',periphrastic:['vaig','vas','va','vam','vau','van']}
];



// ==================== BASE DE PI√àGES MANUELS ====================
const TRAPS_DB = {
    'ser': {
        present: {
            0: ['so', 'soy', 'soco'],
            1: ['est', 'es', 'estas'],
            2: ['est', 'es', 'esta'],
            3: ['somos', 'semos', 'somes'],
            4: ['sois', 'seus', 'sou'],
            5: ['son', 's√≥n', 'sonen']
        },
        subjunctive: {
            0: ['siga', 'siguia', 'sea'],
            1: ['sigas', 'sigues', 'siguias'],
            2: ['siga', 'sigue', 'siguia'],
            3: ['sigamos', 'siguem', 'sigu√©mos'],
            4: ['sig√°is', 'sigueu', 'sigui'],
            5: ['sigan', 'siguen', 'siguian']
        },
        future: {
            0: ['serai', 'ser√≥', 'seria'],
            1: ['seras', 'ser√†s', 'serias'],
            2: ['sera', 'ser√†', 'seria']
        },
        imperfect: {
            0: ['ero', 'erea', 'ere'],
            1: ['eras', 'eres', 'erias'],
            2: ['era', 'ero', 'eria']
        },
        gerund: ['siendo', 'sent', 'esent']
    },
    'tenir': {
        present: {
            0: ['tengo', 'tingo', 'tenc'],
            1: ['tienes', 'tenes', 'ten'],
            2: ['tiene', 'tene', 'ten'],
            3: ['tenemos', 'tenem', 'tenims'],
            4: ['ten√©is', 'teneu', 'tenis'],
            5: ['tienen', 'tenen', 'tenens']
        },
        subjunctive: {
            0: ['tenga', 'tinga', 'tengui'],
            1: ['tengas', 'tingas', 'tingues'],
            2: ['tenga', 'tinga', 'tingue'],
            3: ['tengamos', 'tinguem', 'tinguemos'],
            4: ['teng√°is', 'tingueu', 'tingui'],
            5: ['tengan', 'tinguen', 'tinguan']
        },
        future: {
            0: ['tendr√©', 'tindrai', 'tendrai'],
            1: ['tendr√°s', 'tindras', 'tendras'],
            2: ['tendr√°', 'tindr√†', 'tendr√†']
        },
        imperfect: {
            0: ['ten√≠a', 'tenie', 'teniea'],
            1: ['ten√≠as', 'tenias', 'tenies'],
            2: ['ten√≠a', 'tenia', 'tenie']
        },
        gerund: ['teniendo', 'tenint', 'tenent']
    },
    'anar': {
        present: {
            0: ['voy', 'vago', 'anaig'],
            1: ['vas', 'va', 'vais'],
            2: ['va', 'vas', 'vai'],
            3: ['vamos', 'anem', 'anamos'],
            4: ['vais', 'aneu', 'anes'],
            5: ['van', 'vanen', 'vanan']
        },
        subjunctive: {
            0: ['vaya', 'vagi', 'anegi'],
            1: ['vayas', 'vagis', 'vaguis'],
            2: ['vaya', 'vage', 'vagi'],
            3: ['vayamos', 'anem', 'vaguem'],
            4: ['vay√°is', 'aneu', 'vagueu'],
            5: ['vayan', 'vagin', 'vaguen']
        },
        future: {
            0: ['ir√©', 'anar√©', 'anirai'],
            1: ['ir√°s', 'anar√†s', 'aniras'],
            2: ['ir√°', 'anar√°', 'anir√†']
        },
        imperfect: {
            0: ['iba', 'anava', 'anave'],
            1: ['ibas', 'anaves', 'anavas'],
            2: ['iba', 'anava', 'anave']
        },
        gerund: ['yendo', 'anent', 'anant']
    },
    'fer': {
        present: {
            0: ['hago', 'fa√ßo', 'fago'],
            1: ['haces', 'fas', 'faces'],
            2: ['hace', 'fa', 'face'],
            3: ['hacemos', 'fem', 'fems'],
            4: ['hac√©is', 'feu', 'feis'],
            5: ['hacen', 'fan', 'faen']
        },
        subjunctive: {
            0: ['haga', 'faci', 'faga'],
            1: ['hagas', 'facis', 'fagis'],
            2: ['haga', 'face', 'faci'],
            3: ['hagamos', 'fem', 'faguem'],
            4: ['hag√°is', 'feu', 'faceu'],
            5: ['hagan', 'facin', 'fagan']
        },
        future: {
            0: ['har√©', 'ferei', 'farai'],
            1: ['har√°s', 'fer√†s', 'faras'],
            2: ['har√°', 'fer√†', 'far√†']
        },
        imperfect: {
            0: ['hac√≠a', 'feia', 'feie'],
            1: ['hac√≠as', 'feies', 'feias'],
            2: ['hac√≠a', 'feia', 'feie']
        },
        gerund: ['haciendo', 'fent', 'feint']
    },
    'poder': {
        present: {
            0: ['puedo', 'podo', 'puddo'],
            1: ['puedes', 'pots', 'podes'],
            2: ['puede', 'pot', 'pode'],
            3: ['podemos', 'podem', 'podoms'],
            4: ['pod√©is', 'podeu', 'podes'],
            5: ['pueden', 'poden', 'podden']
        },
        subjunctive: {
            0: ['pueda', 'puga', 'pugui'],
            1: ['puedas', 'puguis', 'pugas'],
            2: ['pueda', 'puga', 'pugue'],
            3: ['podamos', 'puguem', 'poguem'],
            4: ['pod√°is', 'pugueu', 'podeu'],
            5: ['puedan', 'puguin', 'puguen']
        },
        future: {
            0: ['podr√©', 'podrai', 'podar√©'],
            1: ['podr√°s', 'podr√†s', 'podras'],
            2: ['podr√°', 'podr√†', 'podra']
        },
        imperfect: {
            0: ['pod√≠a', 'podia', 'podie'],
            1: ['pod√≠as', 'podies', 'podias'],
            2: ['pod√≠a', 'podia', 'podie']
        },
        gerund: ['pudiendo', 'podent', 'podint']
    },
    'voler': {
        present: {
            0: ['quiero', 'volo', 'vullo'],
            1: ['quieres', 'vols', 'voles'],
            2: ['quiere', 'vol', 'vole'],
            3: ['queremos', 'volem', 'volems'],
            4: ['quer√©is', 'voleu', 'voles'],
            5: ['quieren', 'volen', 'volenn']
        },
        subjunctive: {
            0: ['quiera', 'vulgui', 'volga'],
            1: ['quieras', 'vulguis', 'volguis'],
            2: ['quiera', 'vulgui', 'vulgue'],
            3: ['queramos', 'vulguem', 'voguem'],
            4: ['quer√°is', 'vulgueu', 'volgueu'],
            5: ['quieran', 'vulguin', 'volguin']
        },
        future: {
            0: ['querr√©', 'voldrai', 'voldar√©'],
            1: ['querr√°s', 'voldr√†s', 'voldras'],
            2: ['querr√°', 'voldr√†', 'voldra']
        },
        imperfect: {
            0: ['quer√≠a', 'volia', 'volie'],
            1: ['quer√≠as', 'volies', 'volias'],
            2: ['quer√≠a', 'volia', 'volie']
        },
        gerund: ['queriendo', 'volent', 'volint']
    },
    'dir': {
        present: {
            0: ['digo', 'dico', 'dig'],
            1: ['dices', 'dius', 'dis'],
            2: ['dice', 'diu', 'di'],
            3: ['decimos', 'diem', 'dims'],
            4: ['dec√≠s', 'dieu', 'dies'],
            5: ['dicen', 'diuen', 'dien']
        },
        subjunctive: {
            0: ['diga', 'digui', 'diga'],
            1: ['digas', 'diguis', 'digas'],
            2: ['diga', 'digui', 'digue'],
            3: ['digamos', 'diguem', 'diguemos'],
            4: ['dig√°is', 'digueu', 'digueu'],
            5: ['digan', 'diguin', 'diguen']
        },
        future: {
            0: ['dir√©', 'dirai', 'dierei'],
            1: ['dir√°s', 'dir√†s', 'diras'],
            2: ['dir√°', 'dir√†', 'dira']
        },
        imperfect: {
            0: ['dec√≠a', 'deia', 'deie'],
            1: ['dec√≠as', 'deies', 'deias'],
            2: ['dec√≠a', 'deia', 'deie']
        },
        gerund: ['diciendo', 'dient', 'dint']
    },
    'venir': {
        present: {
            0: ['vengo', 'vingo', 'venc'],
            1: ['vienes', 'v√©ns', 'vens'],
            2: ['viene', 'v√©', 've'],
            3: ['venimos', 'venim', 'venims'],
            4: ['ven√≠s', 'veniu', 'venis'],
            5: ['vienen', 'v√©nen', 'venen']
        },
        subjunctive: {
            0: ['venga', 'vingui', 'venga'],
            1: ['vengas', 'vinguis', 'venguis'],
            2: ['venga', 'vingui', 'vengue'],
            3: ['vengamos', 'vinguem', 'venguem'],
            4: ['veng√°is', 'vingueu', 'vengueu'],
            5: ['vengan', 'vinguin', 'venguen']
        },
        future: {
            0: ['vendr√©', 'vindrai', 'vendar√©'],
            1: ['vendr√°s', 'vindr√†s', 'vendras'],
            2: ['vendr√°', 'vindr√†', 'vendra']
        },
        imperfect: {
            0: ['ven√≠a', 'venia', 'venie'],
            1: ['ven√≠as', 'venies', 'venias'],
            2: ['ven√≠a', 'venia', 'venie']
        },
        gerund: ['viniendo', 'venint', 'venient']
    },
    'saber': {
        present: {
            0: ['s√©', 'sapo', 'sabo'],
            1: ['sabes', 'saps', 'sabes'],
            2: ['sabe', 'sap', 'sabe'],
            3: ['sabemos', 'sabem', 'sabims'],
            4: ['sab√©is', 'sabeu', 'sabes'],
            5: ['saben', 'saben', 'sabenn']
        },
        subjunctive: {
            0: ['sepa', 's√†piga', 'sapia'],
            1: ['sepas', 's√†pigues', 'sapias'],
            2: ['sepa', 's√†piga', 'sapia'],
            3: ['sepamos', 'sapiguem', 'sapiguemos'],
            4: ['sep√°is', 'sapigueu', 'sapieu'],
            5: ['sepan', 's√†piguen', 'sapian']
        },
        future: {
            0: ['sabr√©', 'sabrai', 'sabar√©'],
            1: ['sabr√°s', 'sabr√†s', 'sabras'],
            2: ['sabr√°', 'sabr√†', 'sabra']
        },
        imperfect: {
            0: ['sab√≠a', 'sabia', 'sabie'],
            1: ['sab√≠as', 'sabies', 'sabias'],
            2: ['sab√≠a', 'sabia', 'sabie']
        },
        gerund: ['sabiendo', 'sabent', 'sabint']
    },
    'veure': {
        present: {
            0: ['veo', 'veigo', 'veg'],
            1: ['ves', 'veus', 'ves'],
            2: ['ve', 'veu', 've'],
            3: ['vemos', 'veiem', 'vems'],
            4: ['veis', 'veieu', 'ves'],
            5: ['ven', 'veuen', 'veen']
        },
        subjunctive: {
            0: ['vea', 'vegi', 'vegia'],
            1: ['veas', 'vegis', 'veguis'],
            2: ['vea', 'vegi', 'vege'],
            3: ['veamos', 'vegem', 'veguem'],
            4: ['ve√°is', 'vegeu', 'vegeu'],
            5: ['vean', 'vegin', 'vegen']
        },
        future: {
            0: ['ver√©', 'veur√©', 'veurai'],
            1: ['ver√°s', 'veur√†s', 'veuras'],
            2: ['ver√°', 'veur√†', 'veura']
        },
        imperfect: {
            0: ['ve√≠a', 'veia', 'veie'],
            1: ['ve√≠as', 'veies', 'veias'],
            2: ['ve√≠a', 'veia', 'veie']
        },
        gerund: ['viendo', 'veient', 'veint']
    },
    'parlar': {
        present: {
            0: ['hablo', 'parlo', 'parle'],
            1: ['hablas', 'parles', 'parlas'],
            2: ['habla', 'parla', 'parle'],
            3: ['hablamos', 'parlem', 'parlams'],
            4: ['habl√°is', 'parleu', 'parles'],
            5: ['hablan', 'parlen', 'parlann']
        },
        subjunctive: {
            0: ['hable', 'parli', 'parle'],
            1: ['hables', 'parlis', 'parleis'],
            2: ['hable', 'parli', 'parle'],
            3: ['hablemos', 'parlem', 'parliem'],
            4: ['habl√©is', 'parleu', 'parlieu'],
            5: ['hablen', 'parlin', 'parlen']
        },
        future: {
            0: ['hablar√©', 'parlarai', 'parlar√©'],
            1: ['hablar√°s', 'parlar√†s', 'parlaras'],
            2: ['hablar√°', 'parlar√†', 'parlara']
        },
        imperfect: {
            0: ['hablaba', 'parlava', 'parlave'],
            1: ['hablabas', 'parlaves', 'parlavas'],
            2: ['hablaba', 'parlava', 'parlave']
        },
        gerund: ['hablando', 'parlant', 'parlent']
    },
    'viure': {
        present: {
            0: ['vivo', 'visco', 'visc'],
            1: ['vives', 'vius', 'vives'],
            2: ['vive', 'viu', 'vive'],
            3: ['vivimos', 'vivim', 'vivims'],
            4: ['viv√≠s', 'viveu', 'viviu', 'viueu'],
            5: ['viven', 'viuen', 'vivenn']
        },
        subjunctive: {
            0: ['viva', 'visqui', 'viva'],
            1: ['vivas', 'visquis', 'visques'],
            2: ['viva', 'visqui', 'visque'],
            3: ['vivamos', 'visquem', 'visquemos'],
            4: ['viv√°is', 'visqueu', 'visquieu'],
            5: ['vivan', 'visquin', 'visquen']
        },
        future: {
            0: ['vivir√©', 'viurai', 'viur√©'],
            1: ['vivir√°s', 'viur√†s', 'viuras'],
            2: ['vivir√°', 'viur√†', 'viura']
        },
        imperfect: {
            0: ['viv√≠a', 'vivia', 'vivie'],
            1: ['viv√≠as', 'vivies', 'vivias'],
            2: ['viv√≠a', 'vivia', 'vivie']
        },
        gerund: ['viviendo', 'vivint', 'vivent']
    },
    'escriure': {
        present: {
            0: ['escribo', 'escrico', 'escric'],
            1: ['escribes', 'escrius', 'escrives'],
            2: ['escribe', 'escriu', 'escrive'],
            3: ['escribimos', 'escrivim', 'escrivims'],
            4: ['escrib√≠s', 'escriveu', 'escriviu', 'escriueu'],
            5: ['escriben', 'escriuen', 'escrivenn']
        },
        subjunctive: {
            0: ['escriba', 'escrigui', 'escriva'],
            1: ['escribas', 'escriguis', 'escrives'],
            2: ['escriba', 'escrigui', 'escrive'],
            3: ['escribamos', 'escriguem', 'escrivem'],
            4: ['escrib√°is', 'escrigueu', 'escriveu'],
            5: ['escriban', 'escriguin', 'escriven']
        },
        future: {
            0: ['escribir√©', 'escriurai', 'escriur√©'],
            1: ['escribir√°s', 'escriur√†s', 'escriuras'],
            2: ['escribir√°', 'escriur√†', 'escriura']
        },
        imperfect: {
            0: ['escrib√≠a', 'escrivia', 'escrivie'],
            1: ['escrib√≠as', 'escrivies', 'escrivias'],
            2: ['escrib√≠a', 'escrivia', 'escrivie']
        },
        gerund: ['escribiendo', 'escrivint', 'escrivent']
    },
    'servir': {
        present: {
            0: ['sirvo', 'servixo', 'servisco', 'serveisco'],
            1: ['sirves', 'servixes', 'servis', 'servix'],
            2: ['sirve', 'servix', 'serveis', 'serveix'],
            3: ['servimos', 'servim', 'servims'],
            4: ['serv√≠s', 'serveu', 'serviu'],
            5: ['sirven', 'serveixen', 'servixenn']
        },
        subjunctive: {
            0: ['sirva', 'serveixi', 'servixe'],
            1: ['sirvas', 'serveixis', 'servixes'],
            2: ['sirva', 'serveixi', 'servixe'],
            3: ['sirvamos', 'servim', 'serveixem'],
            4: ['sirv√°is', 'serviu', 'serveixeu'],
            5: ['sirvan', 'serveixin', 'servixen']
        },
        future: {
            0: ['servir√©', 'servirai', 'serverei'],
            1: ['servir√°s', 'servir√†s', 'serviras'],
            2: ['servir√°', 'servir√†', 'servira']
        },
        imperfect: {
            0: ['serv√≠a', 'servia', 'servie'],
            1: ['serv√≠as', 'servies', 'servias'],
            2: ['serv√≠a', 'servia', 'servie']
        },
        gerund: ['sirviendo', 'servindo', 'servint']
    },
    'llegir': {
        present: {
            0: ['leo', 'llegixo', 'llegisco'],
            1: ['lees', 'llegixes', 'llegix'],
            2: ['lee', 'llegix', 'llegeix'],
            3: ['leemos', 'llegim', 'llegims'],
            4: ['le√©is', 'llegeu', 'llegiu'],
            5: ['leen', 'llegeixen', 'llegixenn']
        },
        subjunctive: {
            0: ['lea', 'llegeixi', 'llegixe'],
            1: ['leas', 'llegeixis', 'llegixes'],
            2: ['lea', 'llegeixi', 'llegixe'],
            3: ['leamos', 'llegim', 'llegeixem'],
            4: ['le√°is', 'llegiu', 'llegeixeu'],
            5: ['lean', 'llegeixin', 'llegixen']
        },
        future: {
            0: ['leer√©', 'llegirai', 'llegir√©'],
            1: ['leer√°s', 'llegir√†s', 'llegiras'],
            2: ['leer√°', 'llegir√†', 'llegira']
        },
        imperfect: {
            0: ['le√≠a', 'llegia', 'llegie'],
            1: ['le√≠as', 'llegies', 'llegias'],
            2: ['le√≠a', 'llegia', 'llegie']
        },
        gerund: ['leyendo', 'llegindo', 'llegint']
    },
    'menjar': {
        present: {
            0: ['como', 'menjo', 'menge'],
            1: ['comes', 'menges', 'menjas'],
            2: ['come', 'menja', 'menje'],
            3: ['comemos', 'mengem', 'menjams'],
            4: ['com√©is', 'mengeu', 'menjes'],
            5: ['comen', 'mengen', 'menjann']
        },
        subjunctive: {
            0: ['coma', 'mengi', 'menje'],
            1: ['comas', 'mengis', 'menjis'],
            2: ['coma', 'mengi', 'menje'],
            3: ['comamos', 'mengem', 'mengiem'],
            4: ['com√°is', 'mengeu', 'mengieu'],
            5: ['coman', 'mengin', 'menjen']
        },
        future: {
            0: ['comer√©', 'menjarai', 'menjar√©'],
            1: ['comer√°s', 'menjar√†s', 'menjaras'],
            2: ['comer√°', 'menjar√°', 'menjara']
        },
        imperfect: {
            0: ['com√≠a', 'menjava', 'menjave'],
            1: ['com√≠as', 'menjaves', 'menjavas'],
            2: ['com√≠a', 'menjava', 'menjave']
        },
        gerund: ['comiendo', 'menjando', 'menjant']
    }
};


const PRONOUNS = [
    {ca:'jo',fr:'je',es:'yo',i:0},
    {ca:'tu',fr:'tu',es:'t√∫',i:1},
    {ca:'ell/ella',fr:'il/elle',es:'√©l/ella',i:2},
    {ca:'nosaltres',fr:'nous',es:'nosotros/as',i:3},
    {ca:'vosaltres',fr:'vous',es:'vosotros/as',i:4},
    {ca:'ells/elles',fr:'ils/elles',es:'ellos/ellas',i:5}
];

const TRANSLATIONS = {
    fr: {
        title: 'R√©vision Catalan',
        menu: {
            title: 'Menu Principal',
            verbs: 'Verbes',
            selectTenses: 'S√©lectionner les temps',
            start: 'Commencer',
            vocab: 'Vocabulaire',
            soon: '(Bient√¥t)',
            changeLang: 'Changer de langue'
        },
        tenses: {
            present: 'Pr√©sent',
            subjunctive: 'Subjonctif',
            future: 'Futur',
            imperfect: 'Imparfait',
            gerund: 'G√©rondif',
            periphrastic: 'Pass√© p√©riphrastique'
        },
        game: {
            back: '‚Üê Menu',
            step1: '√âtape 1: Traduction',
            step2: '√âtape 2: Conjugaison',
            verb: 'Verbe',
            q1: 'Quelle est la traduction en catalan ?',
            q2: 'au',
            full: 'Conjugaison compl√®te de',
            next: 'Question suivante',
            ok: 'OK, continuer',
	    reviewMode: "Mode R√©vision : Correction des erreurs"
        },
        stats: {
            title: 'R√©capitulatif',
            questions: 'questions',
            translation: 'Traduction',
            continue: 'Continuer',
            menu: 'Menu',
            // Nouveaux champs pour renderStats
            detailTitle: 'D√©tail par verbe',
            congrats: 'F√©licitations ! Tes 10 derniers verbes sont parfaits. ‚ú®',
            focus: "Points d'attention (2 pires verbes) :",
	    retryButton: "Revoir les verbes probl√©matiques"
        }
    },
    es: {
        title: 'Repaso Catal√°n',
        menu: {
            title: 'Men√∫ Principal',
            verbs: 'Verbos',
            selectTenses: 'Seleccionar tiempos',
            start: 'Comenzar',
            vocab: 'Vocabulario',
            soon: '(Pr√≥ximamente)',
            changeLang: 'Cambiar idioma'
        },
        tenses: {
            present: 'Presente',
            subjunctive: 'Subjuntivo',
            future: 'Futuro',
            imperfect: 'Imperfecto',
            gerund: 'Gerundio',
            periphrastic: 'Pasado perifr√°stico'
        },
        game: {
            back: '‚Üê Men√∫',
            step1: 'Paso 1: Traducci√≥n',
            step2: 'Paso 2: Conjugaci√≥n',
            verb: 'Verbo',
            q1: '¬øCu√°l es la traducci√≥n al catal√°n?',
            q2: 'en',
            full: 'Conjugaci√≥n completa de',
            next: 'Siguiente pregunta',
            ok: 'OK, continuar',
	    reviewMode: "Modo Revisi√≥n: Correcci√≥n de errores"
        },
        stats: {
            title: 'Resumen',
            questions: 'preguntas',
            translation: 'Traducci√≥n',
            continue: 'Continuar',
            menu: 'Men√∫',
            // Nouveaux champs pour renderStats
            detailTitle: 'Detalle por verbo',
            congrats: '¬°Felicidades! Tus √∫ltimos 10 verbos son perfectos. ‚ú®',
            focus: 'Puntos de atenci√≥n (2 peores verbos):',
	    retryButton: "Repasar verbos con errores"
        }
    }
};
// ==================== √âTAT GLOBAL ====================
let state = {
    screen:'language',lang:null,stage:'translation',verb:null,pron:null,opts:[],sel:null,show:false,
    score:0,total:0,qCount:0,tenses:{present:true,subjunctive:false,future:false,imperfect:false,periphrastic:false},tense:null,verbStats:{},pool:null
};

// ==================== FONCTIONS PRINCIPALES ====================
function selectLanguage(l){state.lang=l;state.screen='menu';render();}
function goToMenu() {
    state.pool = null; // Important pour ne pas rester bloqu√© en mode r√©vision
    state.screen = 'menu';
    render();
}
function goToLanguage(){state={screen:'language',lang:null,stage:'translation',verb:null,pron:null,opts:[],sel:null,show:false,score:0,total:0,qCount:0,tenses:{present:true,subjunctive:false,future:false,imperfect:false,periphrastic:false},tense:null,verbStats:{}};render();}
function toggleTense(t){state.tenses[t]=!state.tenses[t];render();}

function startVerbs(){
    const has=Object.values(state.tenses).some(x=>x);
    if(!has){alert(state.lang==='fr'?'S√©lectionnez au moins un temps':'Seleccione al menos un tiempo');return;}
    state.screen='verbs';state.score=0;state.total=0;state.qCount=0;state.verbStats={};
    startQ();
}

function initStats(ca) {
    if (!state.verbStats[ca]) {
        state.verbStats[ca] = { 
            translation: { ok: 0, total: 0 } 
        };
        Object.keys(state.tenses).forEach(t => {
            // On cr√©e un tableau de 6 objets (un par personne)
            state.verbStats[ca][t] = Array.from({ length: 6 }, () => ({ ok: 0, total: 0 }));
        });
    }
}

function genTrOpts(v){
    const d=VERBS_DB.filter(x=>x.ca!==v.ca).sort(()=>Math.random()-0.5).slice(0,3).map(x=>x.ca);
    return[v.ca,...d].sort(()=>Math.random()-0.5);
}



function genConjOpts(v, idx, tense) {
    // Cas sp√©ciaux
    if (tense === 'gerund') {
        const correct = v.gerund;
        const manualTraps = TRAPS_DB[v.ca]?.gerund || [];
        const options = [correct];
        
        // Ajouter pi√®ges manuels
        options.push(...shuffle(manualTraps));
        
        // Compl√©ter avec variations automatiques si besoin
        if (options.length < 4) {
            const autoTraps = [
                correct.replace('ant', 'ent'),
                correct.replace('int', 'ient'),
                correct + 'o',
                correct.replace('ent', 'ant')
            ].filter(t => t !== correct && !options.includes(t));
            options.push(...autoTraps);
        }
        
        return shuffle(options.slice(0, 4));
    }
    
    if (tense === 'periphrastic') {
        const correct = v.periphrastic[idx];
        const traps = ['vais', 'vaijo', 'vago', 'vais a'];
        return shuffle([correct, ...traps.slice(0, 3)]);
    }

    // Conjugaisons normales
    const correct = v[tense][idx];
    const options = [correct];
    
    // 1. Pi√®ges manuels (priorit√©)
    const manualTraps = TRAPS_DB[v.ca]?.[tense]?.[idx] || [];
    manualTraps.forEach(trap => {
        if (!options.includes(trap)) {
            options.push(trap);
        }
    });
    
    // 2. Autres personnes du m√™me verbe (si besoin)
    if (options.length < 4) {
        const otherPersons = v[tense]
            .filter((form, i) => i !== idx && !options.includes(form));
        shuffle(otherPersons).forEach(form => {
            if (options.length < 4 && !options.includes(form)) {
                options.push(form);
            }
        });
    }
    
    // 3. Formes d'autres verbes similaires (si vraiment besoin)
    if (options.length < 4) {
        const similarVerbs = VERBS_DB.filter(vb => 
            vb.ca !== v.ca && 
            vb[tense] && 
            vb[tense][idx] !== correct &&
            !options.includes(vb[tense][idx])
        );
        shuffle(similarVerbs).forEach(vb => {
            if (options.length < 4 && !options.includes(vb[tense][idx])) {
                options.push(vb[tense][idx]);
            }
        });
    }
    
    // S'assurer qu'on a exactement 4 options
    return shuffle(options.slice(0, 4));
}

function shuffle(array) {
    return [...array].sort(() => Math.random() - 0.5);
}



function startQ() {
    const active = Object.keys(state.tenses).filter(k => state.tenses[k]);
    const tense = active[Math.floor(Math.random() * active.length)];
    const pron = PRONOUNS[Math.floor(Math.random() * PRONOUNS.length)];

    // LOGIQUE DE S√âLECTION : Si state.pool existe, on pioche dedans, sinon dans VERBS_DB
    const source = state.pool || VERBS_DB;
    const verb = source[Math.floor(Math.random() * source.length)];

    initStats(verb.ca);
    state.verb = verb; 
    state.pron = pron; 
    state.tense = tense; 
    state.stage = 'translation';
    state.opts = genTrOpts(verb); 
    state.sel = null; 
    state.show = false;
    render();
}

function handleAns(ans) {
    state.sel = ans;
    state.show = true;

    if (state.stage === 'translation') {
        const isCorrect = ans === state.verb.ca;
        
        // Mise √† jour du compteur de traduction
        state.verbStats[state.verb.ca].translation.total++;
        if (isCorrect) {
            state.verbStats[state.verb.ca].translation.ok++;
            state.score += 0.5;
        }
        
        state.total++;
        if (isCorrect) {
            state.stage = 'conjugation';
            state.opts = genConjOpts(state.verb, state.pron.i, state.tense);
            state.sel = null;
            state.show = false;
        }
        render();
    } else {
        const correct = state.verb[state.tense][state.pron.i];
        const isCorrect = ans === correct;

        // Mise √† jour du compteur de conjugaison (temps + personne)
        const stat = state.verbStats[state.verb.ca][state.tense][state.pron.i];
        stat.total++;
        if (isCorrect) {
            stat.ok++;
            state.score += 0.5;
        }

        state.qCount++;
        render();
    }
}

function next(){
    if(state.stage === 'translation'){
        // On passe √† la conjugaison du m√™me verbe
        state.stage = 'conjugation';
        state.opts = genConjOpts(state.verb, state.pron.i, state.tense);
        state.sel = null;
        state.show = false;
        render();
    } else {
        // On a fini la paire, on v√©rifie si on doit afficher les stats ou le verbe suivant
        if(state.qCount > 0 && state.qCount % 10 === 0){
            state.screen = 'stats';
            render();
        } else {
            startQ();
        }
    }
}

function retryErrors() {
	const verbsWithErrors = Object.keys(state.verbStats).filter(ca => {
        const s = state.verbStats[ca];
        const hasTrErr = s.translation.total > 0 && s.translation.ok < s.translation.total;
        const hasConjErr = Object.keys(state.tenses).some(t => 
            s[t] && s[t].some(st => st.total > 0 && st.ok < st.total)
        );
        return hasTrErr || hasConjErr;
    });

    if (verbsWithErrors.length === 0) return;

    // On pr√©pare le pool d'erreurs
    state.pool = VERBS_DB.filter(v => verbsWithErrors.includes(v.ca));
    
    // On r√©initialise seulement le compteur de la s√©rie, pas le score global
    state.qCount = 0;
    state.screen = 'verbs';
    startQ();
}

function continueStats() {
    state.pool = null; // On repasse en mode normal (pioche dans tout VERBS_DB)
    state.qCount = 0;
    state.screen = 'verbs';
    startQ();
}



// ==================== RENDU ====================
function renderLang(){
    return`<div class="max-w-md mx-auto mt-20"><div class="bg-white rounded-lg shadow-xl p-8 text-center">
    <h1 class="text-4xl font-bold text-indigo-900 mb-8">üá™üá∏ Catal√† üá´üá∑</h1>
    <p class="text-gray-600 mb-8">Choisissez votre langue / Elige tu idioma</p>
    <div class="space-y-4">
    <button onclick="selectLanguage('fr')" class="w-full bg-indigo-600 text-white py-4 rounded-lg font-bold text-xl hover:bg-indigo-700">üá´üá∑ Fran√ßais</button>
    <button onclick="selectLanguage('es')" class="w-full bg-red-600 text-white py-4 rounded-lg font-bold text-xl hover:bg-red-700">üá™üá∏ Espa√±ol</button>
    </div></div></div>`;
}

function renderMenu(){
    const t=TRANSLATIONS[state.lang].menu;
    const tn=TRANSLATIONS[state.lang].tenses;
    return`<div class="max-w-md mx-auto mt-10"><div class="bg-white rounded-lg shadow-xl p-8">
    <h1 class="text-3xl font-bold text-indigo-900 mb-6 text-center">${t.title}</h1>
    <div class="bg-blue-50 p-4 rounded-lg mb-6">
    <h2 class="font-bold text-blue-900 mb-3">${t.selectTenses}</h2>
    <div class="space-y-2">
    ${Object.keys(state.tenses).map(k=>`<label class="flex items-center gap-2 cursor-pointer">
    <input type="checkbox" ${state.tenses[k]?'checked':''} onchange="toggleTense('${k}')" class="w-4 h-4">
    <span>${tn[k]}</span></label>`).join('')}
    </div></div>
    <button onclick="startVerbs()" class="w-full bg-indigo-600 text-white py-4 rounded-lg font-bold text-xl hover:bg-indigo-700 mb-4">${t.start}</button>
    <button disabled class="w-full bg-gray-300 text-gray-500 py-4 rounded-lg font-bold mb-4 cursor-not-allowed">${t.vocab} ${t.soon}</button>
    <button onclick="goToLanguage()" class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">üåê ${t.changeLang}</button>
    </div></div>`;
}

function renderStats() {
    const lang = state.lang;
    const t = TRANSLATIONS[lang].stats;
    const tn = TRANSLATIONS[lang].tenses;
    const list = Object.keys(state.verbStats);

    // --- 1. CALCULS DES SCORES & RANKINGS ---
    let totalCorrect = 0;
    let totalPossible = 0;
    const scoresByTense = { translation: { ok: 0, total: 0 } };
    const verbRankings = [];

    list.forEach(ca => {
        const s = state.verbStats[ca];
        const v = VERBS_DB.find(x => x.ca === ca);
        let verbCorrect = 0;
        let verbTotal = 0;

        // Traduction
        if (s.translation.total > 0) {
            scoresByTense.translation.ok += s.translation.ok;
            scoresByTense.translation.total += s.translation.total;
            verbCorrect += s.translation.ok;
            verbTotal += s.translation.total;
        }

        // Conjugaisons
        Object.keys(state.tenses).forEach(tense => {
            if (state.tenses[tense] && s[tense]) {
                if (!scoresByTense[tense]) scoresByTense[tense] = { ok: 0, total: 0 };
                s[tense].forEach(stat => {
                    if (stat.total > 0) {
                        scoresByTense[tense].ok += stat.ok;
                        scoresByTense[tense].total += stat.total;
                        verbCorrect += stat.ok;
                        verbTotal += stat.total;
                    }
                });
            }
        });

        totalCorrect += verbCorrect/2;
        totalPossible += verbTotal/2;
        
        if (verbTotal > 0) {
            verbRankings.push({ 
                ca: ca, 
                display: v.ca.toUpperCase(),
                ratio: verbCorrect / verbTotal
            });
        }
    });

    // --- LOGIQUE DES 10 DERNIERS & PIRES VERBES ---
    // Les 10 derniers verbes test√©s
    const last10Entries = verbRankings.slice(-10);
    const perfectLast10 = last10Entries.length > 0 && last10Entries.every(v => v.ratio === 1);
    
    // Les 2 pires sur toute la session (uniquement ceux qui ont des erreurs)
    const worstVerbs = [...verbRankings]
        .filter(v => v.ratio < 1)
        .sort((a, b) => a.ratio - b.ratio)
        .slice(0, 2);
   
    // On ajoute les boutons d'erreurs	
    const hasGlobalErrors = list.some(ca => {
    const s = state.verbStats[ca];
    const trErr = s.translation.ok < s.translation.total;
    const conjErr = Object.keys(state.tenses).some(t => 
        s[t] && s[t].some(st => st.total > 0 && st.ok < st.total)
    );
    return trErr || conjErr;
});


    // --- 2. RENDU HTML ---
return `
<div class="max-w-4xl mx-auto relative">
    <div class="absolute -top-2 right-4 bg-indigo-600 text-white px-6 py-3 rounded-2xl shadow-lg z-10 font-black text-xl">
        ${totalCorrect} / ${totalPossible}
    </div>

    <div class="bg-white rounded-lg shadow-xl p-8 pt-12">
        <h1 class="text-3xl font-bold text-indigo-900 mb-6 text-center">${t.title}</h1>
        
        <div class="flex flex-wrap gap-4 mb-8">
            <button onclick="goToMenu()" class="flex-1 min-w-[120px] bg-gray-100 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-200 transition">
                ${t.menu}
            </button>
            ${hasGlobalErrors ? `
                <button onclick="retryErrors()" class="flex-1 min-w-[120px] bg-orange-500 text-white py-3 rounded-lg font-bold hover:bg-orange-600 transition shadow-md">
                    ${t.retryButton}
                </button>
            ` : ''}
            <button onclick="continueStats()" class="flex-1 min-w-[120px] bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md">
                ${t.continue}
            </button>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
            <div class="bg-amber-50 p-3 rounded-xl border border-amber-100 text-center">
                <div class="text-[10px] font-black text-amber-400 uppercase tracking-widest">${t.translation}</div>
                <div class="text-lg font-bold text-amber-900">${scoresByTense.translation.ok}/${scoresByTense.translation.total}</div>
            </div>
            ${Object.keys(scoresByTense).filter(k => k !== 'translation').map(tense => `
                <div class="bg-indigo-50 p-3 rounded-xl border border-indigo-100 text-center">
                    <div class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">${tn[tense]}</div>
                    <div class="text-lg font-bold text-indigo-900">${scoresByTense[tense].ok}/${scoresByTense[tense].total}</div>
                </div>
            `).join('')}
        </div>

        <div class="mb-10 p-5 rounded-2xl border-2 ${perfectLast10 ? 'bg-green-50 border-green-200' : 'bg-orange-50 border-orange-200'}">
            ${perfectLast10 
                ? `<p class="text-green-800 font-bold text-center">üåü ${t.congrats}</p>`
                : `<div>
                    <p class="text-orange-900 font-bold mb-2 uppercase text-xs tracking-wider">${t.focus}</p>
                    <div class="flex gap-2">
                        ${worstVerbs.length > 0 
                            ? worstVerbs.map(v => `<span class="bg-orange-600 text-white px-3 py-1 rounded-lg font-black shadow-sm">${v.display}</span>`).join('')
                            : `<span class="text-orange-800 italic text-sm">Pas assez de donn√©es.</span>`
                        }
                    </div>
                   </div>`
            }
        </div>

        <h2 class="text-xl font-black text-gray-300 mb-6 flex items-center gap-4 uppercase">
            <span class="flex-grow h-px bg-gray-100"></span> ${t.detailTitle} <span class="flex-grow h-px bg-gray-100"></span>
        </h2>

        <div class="space-y-6">
            ${list.map(ca => {
                const v = VERBS_DB.find(x => x.ca === ca);
                const s = state.verbStats[ca];
                if (!s || s.translation.total === 0) return '';

                let cOk = 0, cTot = 0;
                Object.keys(state.tenses).forEach(tense => {
                    if (state.tenses[tense] && s[tense]) {
                        s[tense].forEach(st => { cOk += st.ok; cTot += st.total; });
                    }
                });

                const trRatio = s.translation.ok / s.translation.total;
                const trColor = trRatio === 1 ? 'bg-green-500' : (trRatio === 0 ? 'bg-red-500' : 'bg-orange-500');

                return `
                <div class="bg-white border border-gray-100 rounded-2xl p-6 shadow-sm">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <h3 class="text-2xl font-black text-indigo-900 uppercase">${v.ca}</h3>
                                ${cTot > 0 ? `<span class="bg-indigo-100 text-indigo-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Conj: ${Math.round((cOk/cTot)*100)}%</span>` : ''}
                            </div>
                            <p class="text-gray-400 italic text-sm">${v[lang]}</p>
                        </div>
                        <div class="${trColor} text-white px-3 py-1 rounded-lg text-[10px] font-black shadow-sm uppercase">
                            ${t.translation}: ${s.translation.ok}/${s.translation.total}
                        </div>
                    </div>

                    ${Object.keys(state.tenses).filter(tense => state.tenses[tense] && s[tense]).map(tense => {
                        // On ne rend le bloc que si des questions ont √©t√© pos√©es pour ce temps
                        const hasTenseData = s[tense].some(stat => stat.total > 0);
                        if (!hasTenseData) return '';

                        return `
                        <div class="bg-gray-50 rounded-xl p-4 mb-4 last:mb-0">
                            <h4 class="text-[10px] font-black text-gray-400 uppercase mb-3 tracking-widest text-center italic">${tn[tense]}</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                                ${PRONOUNS.map((p, i) => {
                                    const stat = s[tense][i];
                                    const hasData = stat.total > 0;
                                    
                                    let bgColor = 'bg-white border-white';
                                    let textColor = 'text-indigo-900';
                                    let dotColor = 'bg-gray-200';

                                    if (hasData) {
                                        const ratio = stat.ok / stat.total;
                                        if (ratio === 1) { bgColor = 'bg-green-50 border-green-100'; textColor = 'text-green-900'; dotColor = 'bg-green-500'; }
                                        else if (ratio === 0) { bgColor = 'bg-red-50 border-red-100'; textColor = 'text-red-900'; dotColor = 'bg-red-500'; }
                                        else { bgColor = 'bg-orange-50 border-orange-100'; textColor = 'text-orange-900'; dotColor = 'bg-orange-500'; }
                                    } else {
                                        bgColor = 'bg-gray-100/50 border-dashed border-gray-200';
                                        textColor = 'text-gray-300';
                                    }
                                    
                                    return `
                                        <div class="flex items-center justify-between px-3 py-2 rounded-lg border shadow-sm transition-all ${bgColor}">
                                            <div class="flex items-center gap-2 overflow-hidden">
                                                <div class="w-1.5 h-1.5 rounded-full shrink-0 ${dotColor}"></div>
                                                <span class="text-sm font-bold truncate ${textColor}">${v[tense][i]}</span>
                                            </div>
                                            ${hasData ? `<span class="text-[9px] font-black opacity-40 ml-2 ${textColor}">${stat.ok}/${stat.total}</span>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>`;
                    }).join('')}
                </div>`;
            }).join('')}
        </div>
    </div>
</div>`;
}


function renderGame(){
    if(!state.verb||!state.pron)return'';
    const t=TRANSLATIONS[state.lang].game;
    const tn=TRANSLATIONS[state.lang].tenses;
    const correctAns=state.stage==='translation'?state.verb.ca:state.verb[state.tense][state.pron.i];
    const isCorrect=state.sel===correctAns;
    const vName=state.verb[state.lang];
    
    return`<div class="max-w-2xl mx-auto"><div class="bg-white rounded-lg shadow-xl p-8">
    <div class="flex justify-between items-center mb-6">
    <button onclick="goToMenu()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">${t.back}</button>
    <div class="flex gap-2">
    <div class="bg-purple-100 px-3 py-2 rounded-lg text-sm font-medium">${state.qCount}</div>
    <div class="bg-indigo-100 px-3 py-2 rounded-lg font-bold">üèÜ ${state.score}/${state.total}</div>
    </div></div>
    <div class="mb-6">
    <div class="flex gap-2 mb-4">
    <div class="flex-1 h-2 rounded ${state.stage==='translation'?'bg-indigo-500':'bg-green-500'}"></div>
    <div class="flex-1 h-2 rounded ${state.stage==='conjugation'?'bg-indigo-500':'bg-gray-300'}"></div>
    </div>
    <p class="text-sm text-gray-600">${state.stage==='translation'?t.step1:t.step2}</p>
    </div>
    ${state.stage==='translation'?`<div class="mb-6">
<h2 class="text-2xl font-bold text-center mb-4">${t.verb}: <span class="text-indigo-600">${vName}</span></h2>
<p class="text-gray-600 text-center">${t.q1}</p></div>`:`<div class="mb-6">
<h2 class="text-2xl font-bold text-indigo-600 text-center mb-4">${
    state.tense==='gerund'?`Estic _____ (${state.verb.ca})`:
    state.tense==='periphrastic'?`${state.pron.ca} _____ ${state.verb.ca}`:
    `${state.pron.ca} _____ (${state.verb.ca}) ${t.q2} ${tn[state.tense]}`
}</h2></div>`}
    <div class="space-y-3">
    ${state.opts.map(o=>`<button onclick="handleAns('${o.replace(/'/g,"\\'")}')" ${state.show?'disabled':''} 
    class="w-full p-4 rounded-lg text-lg font-medium transition ${state.show?o===correctAns?'bg-green-500 text-white':o===state.sel?'bg-red-500 text-white':'bg-gray-100 text-gray-400':'bg-indigo-50 text-indigo-900 hover:bg-indigo-100'}">
    <div class="flex justify-between items-center"><span>${o}</span>
    ${state.show&&o===correctAns?'<span class="text-2xl">‚úì</span>':state.show&&o===state.sel&&o!==correctAns?'<span class="text-2xl">‚úó</span>':''}
    </div></button>`).join('')}
    </div>
    ${state.show&&state.stage==='conjugation'&&!isCorrect?`<div class="mt-4 bg-blue-50 p-4 rounded-lg">
    <h3 class="font-bold text-blue-900 mb-2">${t.full} "${state.verb.ca}" ${t.q2} ${tn[state.tense]}:</h3>
    <div class="grid grid-cols-2 gap-2 text-sm">
    ${PRONOUNS.map((p,i)=>`<div class="text-blue-800"><span class="font-medium">${p.ca}:</span> ${state.verb[state.tense][i]}</div>`).join('')}
    </div></div>`:''} 
    ${state.show?`<button onclick="next()" class="w-full mt-4 bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700">
    ${state.stage==='conjugation'||!isCorrect?t.next:t.ok}</button>`:''}
    </div></div>`;
}

function render(){
    const screens={language:renderLang,menu:renderMenu,verbs:renderGame,stats:renderStats};
    document.getElementById('app').innerHTML=screens[state.screen]();
}

render();
    </script>
</body>
</html>
